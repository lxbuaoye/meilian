<view class="page-container">
  <!-- Navigation bar -->
  <view class="nav-bar" style="padding-top: {{menuBarTop}}px; height: {{menuBarHeight}}px;">
    <view class="nav-content">
      <image src="{{logoImage}}" style="width: 253rpx; height: 38rpx;" mode="scaleToFill"></image>
    </view>
  </view>

  <!-- 已移除独立登录覆盖页，立即预约按钮将直接从微信获取手机号 -->

  <!-- Tabs fixed under nav -->
  <view class="tabs-fixed" style="top: {{menuBarTop + menuBarHeight}}px;">
    <scroll-view class="tabs-scroll" scroll-x="true" wx:if="{{tabs && tabs.length}}" scroll-with-animation="true">
      <view class="tabs" id="tabs">
        <block wx:for="{{tabs}}" wx:key="index" wx:for-index="index" wx:for-item="item">
          <view class="tab-card {{activeTab === index ? 'active' : ''}}" data-index="{{index}}" bindtap="onTabTap">
            <text class="tab-caption">{{item.lx}}</text>
          </view>
        </block>
      </view>
    </scroll-view>
  </view>

  <!-- Main Content: show only current active image; allow vertical scrolling to view full image -->
  <scroll-view class="content-scroll"
    style="margin-top: {{contentMarginTop}}px; padding-bottom: {{contentPaddingBottom}}rpx;" scroll-y
    scroll-top="{{scrollTop}}">
    <view class="image-item">
      <block wx:if="{{tabs && tabs.length}}">
        <image src="{{tabs[activeTab].tpdz || ''}}" mode="widthFix" bindload="onImageLoad" data-index="{{activeTab}}"
          style="width:100%; height: {{imageHeights[activeTab] || currentImageHeight}}rpx;" />
      </block>
    </view>
  </scroll-view>

  <!-- Bottom fixed action bar above tabBar -->
  <view class="bottom-fixed" style="bottom: calc({{tabBarHeightRpx}}rpx + env(safe-area-inset-bottom));">
    <view class="bottom-inner">
      <button class="free-book" bindtap="openBookingModal">免费预约</button>
      <view class="share">
        <image src="/components/icon/share.png" mode="" class="share-btn" />
        <text class="share-text">分享</text>
      </view>
    </view>
  </view>

  <!-- Booking modal -->
  <view wx:if="{{bookingModalVisible}}" class="modal-mask" catchtap="closeBookingModal">
    <view class="modal-body" catchtap="noop">
      <view class="modal-header">
        <text class="modal-title">预约刷新服务</text>
      </view>
      <view class="modal-content">
        <view class="form-row">
          <text class="label">昵称</text>
          <input class="input" value="{{bookingName}}" placeholder="请输入您的称呼" bindinput="onBookingNameInput" />
        </view>

        <view class="form-row">
          <text class="label">联系电话</text>
          <input class="input" value="{{bookingPhone}}" placeholder="请输入手机号" bindinput="onBookingPhoneInput" />
        </view>

        <view class="form-row" catchtap="onChooseLocation">
          <text class="label">所在地区</text>
          <view class="row-with-btn">
            <input class="input" value="{{bookingArea}}" placeholder="请选择所在城市" disabled catchtap="noop" />
          </view>
          <image src="/components/icon/location.png" mode="" bindtap="onChooseLocation"
            style="position: relative;right: 30rpx;width: 40rpx; height: 40rpx;" />
        </view>

        <view class="form-row">
          <text class="label">小区</text>
          <input class="input" value="{{bookingCommunity}}" placeholder="请输入小区" bindinput="onBookingCommunityInput" />
        </view>

        <view class="form-row">
          <text class="label">详细地址</text>
          <input class="input" value="{{bookingDetailAddress}}" placeholder="请输入详细地址"
            bindinput="onBookingDetailInput" />
        </view>
        <view class="title">需求项目</view>
        <view class="form-row">

          <view class="projects-bar">
            <view class="projects-inner">
              <block wx:for="{{projects}}" wx:key="index" wx:for-index="i" wx:for-item="p">
                <view class="page-project-item {{selectedProjectIndex === i ? 'selected' : ''}}" data-index="{{i}}"
                  bindtap="onSelectProject">
                  <text>{{p}}</text>
                </view>
              </block>
            </view>
          </view>
        </view>
      </view>

      <view class="modal-actions">
        <button class="modal-btn cancel" bindtap="closeBookingModal">取消</button>
        <button class="modal-btn submit" bindtap="submitBookingModal">提交</button>
      </view>
    </view>
  </view>
</view>