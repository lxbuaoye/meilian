<view class="page">
  <!-- 自定义导航栏 -->
  <view class="nav-bar" style="padding-top: {{statusBarHeight}}px;">
    <view class="nav-bar-inner" style="height: {{navBarHeight}}px;">
      <view class="nav-left" bindtap="onBackTap">
        <image class="nav-back-icon" src="{{navBackIcon}}" mode="aspectFit" />
      </view>
      <view class="nav-title">AI 换色</view>
    </view>
  </view>

  <scroll-view class="content" scroll-y="true">
    <!-- 上传图片区域 -->
    <view class="upload-panel">
        <view class="upload-inner" bindtap="onChooseImage">
          <image class="upload-icon" src="{{uploadIcon}}" mode="aspectFit" />
          <text class="upload-text">拍照/上传图片</text>
      </view>
    </view>

    <!-- 产品选择 -->
    <view class="section">
      <view class="section-header">
        <image class="section-dot" src="{{sectionDot}}" mode="aspectFit" />
        <text class="section-title">产品选择</text>
      </view>
      <scroll-view class="product-scroll" scroll-x="true" enable-flex="true">
        <view class="product-list">
          <view wx:for="{{products}}" wx:key="id" class="product-item {{selectedProductMap[index] ? 'product-item--active' : ''}}" bindtap="onSelectProduct" data-index="{{index}}">
            <view class="product-image-wrapper">
              <image class="product-image" src="{{productIcon}}" mode="aspectFill" />
              <image wx:if="{{selectedProductMap[index]}}" class="product-check" src="{{selectedIcon}}" mode="aspectFit" />
            </view>
            <text class="product-name">{{item.name}}</text>
          </view>
        </view>
      </scroll-view>
    </view>

    <!-- 工艺选择 -->
    <view class="section">
      <view class="section-header">
        <image class="section-dot" src="{{sectionDot}}" mode="aspectFit" />
        <text class="section-title">工艺选择</text>
      </view>
      <view class="craft-list">
        <view wx:for="{{crafts}}" wx:key="id" class="craft-item {{selectedCraftMap[index] ? 'craft-item--active' : ''}}" bindtap="onSelectCraft" data-index="{{index}}">
          <text class="craft-text">{{item.name}}</text>
        </view>
      </view>
    </view>
  </scroll-view>

  <!-- 底部按钮 -->
  <view class="footer">
    <button class="primary-button" bindtap="onGenerateTap" hover-class="primary-button--hover">
      <text class="primary-button-text">AI生成</text>
    </button>
  </view>

  <!-- 生成结果弹窗 -->
  <view wx:if="{{resultVisible}}" class="result-mask">
    <view class="result-container">
      <!-- 关闭按钮 -->
      <view class="result-close" bindtap="onCloseResult">
        <image class="result-close-icon" src="{{resultCloseIcon}}" mode="aspectFit" />
      </view>
      <!-- 上方大图 -->
      <view class="result-image-wrap">
        <image class="result-image" src="{{resultImage}}" mode="aspectFill" />
      </view>
      <!-- 下方白底内容区域 -->
      <view class="result-panel">
        <view class="result-panel-inner">
          <view class="result-title-row">
            <image class="result-dot" src="{{resultDot}}" mode="aspectFit" />
            <text class="result-title">产品信息</text>
          </view>
          <view class="result-text-row">产品工艺：新中式，外墙</view>
          <view class="result-text-row">使用产品：</view>
          <scroll-view class="result-products" scroll-x="true" enable-flex="true">
            <view class="result-product-list">
              <view wx:for="{{resultProducts}}" wx:key="index" class="result-product-item">
                <image class="result-product-icon" src="{{productIcon}}" mode="aspectFit" />
                <text class="result-product-name">{{item.name}}</text>
              </view>
            </view>
          </scroll-view>
          <button class="result-download" hover-class="result-download--hover">直接下载</button>
        </view>
      </view>
    </view>
  </view>
</view>